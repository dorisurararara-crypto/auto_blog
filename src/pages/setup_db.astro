---
export const prerender = false;

let message = "";
try {
  const db = Astro.locals.runtime.env.DB;
  
  // posts 테이블 생성
  await db.prepare(`
    CREATE TABLE IF NOT EXISTS posts (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      slug TEXT UNIQUE NOT NULL,
      title TEXT NOT NULL,
      summary TEXT,
      content TEXT NOT NULL,
      category TEXT,
      image_url TEXT,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
    )
  `).run();

  // stats 테이블 생성 (혹시 없을 경우를 대비해)
  await db.prepare(`
    CREATE TABLE IF NOT EXISTS stats (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      type TEXT NOT NULL,
      path TEXT,
      label TEXT,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP
    )
  `).run();

  message = "✅ 데이터베이스 테이블 생성 완료! 이제 관리자 페이지를 새로고침 해보세요.";
} catch (e) {
  message = `❌ 오류 발생: ${e.message}`;
  console.error(e);
}
---

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>DB Setup</title>
</head>
<body>
    <h1>데이터베이스 설정 도구</h1>
    <p>{message}</p>
    <a href="/admin?pw=1234">관리자 페이지로 돌아가기</a>
</body>
</html>
