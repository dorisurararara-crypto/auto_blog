---
import Layout from '../layouts/Layout.astro';

// DB ê¸°ë°˜ í¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
let allPosts = [];
try {
	const db = Astro.locals.runtime.env.DB;
	const { results } = await db.prepare("SELECT * FROM posts ORDER BY created_at DESC").all();
	allPosts = results.map(p => ({
		id: p.id,
		slug: `/blog/${p.slug}`,
		title: p.title,
		summary: p.summary,
		image: p.image_url || '/images/default-post.png',
		date: p.created_at ? p.created_at.split(' ')[0].replace(/-/g, '') : '',
		category: p.category || 'Trend'
	}));
} catch (e) {
	console.error("DB ë¡œë“œ ì‹¤íŒ¨:", e);
}
---

<Layout title="GTB ë§¤ê±°ì§„ - íŠ¸ë Œë“œì˜ ìµœì „ì„ ">
	<div class="hero-section">
		<div class="container">
			<h2>ë§¤ì¼ ë§Œë‚˜ëŠ” ìƒˆë¡œìš´ í†µì°° ğŸ”¥</h2>
			<p>ê¸€ë¡œë²Œ íŠ¸ë Œë“œë¶€í„° IT, ê±´ê°•ê¹Œì§€ ì „ë¬¸ê°€ì˜ ì‹œì„ ìœ¼ë¡œ ë‹´ì•„ëƒ…ë‹ˆë‹¤.</p>
		</div>
	</div>

	<div class="container">
		<div class="grid">
			{allPosts.map((post) => (
				<article class="card">
					<a href={post.slug}>
						<div class="card-image">
							<img src={post.image} alt={post.title} loading="lazy" />
						</div>
						<div class="card-content">
							<span class="tag">{post.category}</span>
							<h3>{post.title}</h3>
							<p class="summary">{post.summary}</p>
							<div class="card-footer">
								<span class="date">{post.date.replace(/(\d{4})(\d{2})(\d{2})/, '$1. $2. $3')}</span>
								<span class="read-more">ë” ë³´ê¸° â†’</span>
							</div>
						</div>
					</a>
				</article>
			))}
		</div>
	</div>
</Layout>

<style>
	.hero-section { background: white; padding: 3rem 0; text-align: center; margin-bottom: 2rem; border-bottom: 1px solid #f3f4f6; }
	.hero-section h2 { font-size: 1.8rem; font-weight: 900; letter-spacing: -1.5px; margin-bottom: 0.5rem; line-height: 1.3; }
	.hero-section p { color: #64748b; font-size: 1rem; padding: 0 1rem; }
	
	.grid { display: grid; grid-template-columns: 1fr; gap: 2.5rem; }
	@media (min-width: 768px) {
		.grid { grid-template-columns: repeat(2, 1fr); gap: 2rem; }
	}
	
	.card { background: white; overflow: hidden; transition: all 0.3s ease; display: flex; flex-direction: column; }
	.card a { text-decoration: none; color: inherit; }
	.card-image { width: 100%; aspect-ratio: 16/9; border-radius: 12px; overflow: hidden; margin-bottom: 1rem; }
	.card-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
	.card:hover .card-image img { transform: scale(1.05); }
	
	.tag { font-size: 0.8rem; color: #2563eb; font-weight: 800; margin-bottom: 0.5rem; display: inline-block; background: #eff6ff; padding: 0.1rem 0.6rem; border-radius: 4px; }
	.card h3 { font-size: 1.35rem; font-weight: 800; margin-bottom: 0.75rem; line-height: 1.4; color: #111827; letter-spacing: -0.5px; }
	.summary { font-size: 1rem; color: #4b5563; line-height: 1.6; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin-bottom: 1rem; }
	.card-footer { display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; color: #94a3b8; font-weight: 500; }
	.read-more { color: #2563eb; font-weight: 700; }
</style>
