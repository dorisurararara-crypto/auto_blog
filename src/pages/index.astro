---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// 1. íŒŒì¼ ê¸°ë°˜ í¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
const filePosts = await getCollection('blog');
const formattedFilePosts = filePosts.map(p => ({
	id: p.id,
	slug: `/blog/${p.slug}`,
	title: p.data.title,
	summary: p.data.summary,
	image: p.data.image,
	date: p.id.split('_')[0],
	source: 'file'
}));

// 2. DB ê¸°ë°˜ í¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸° (ê´€ë¦¬ì ì‘ì„±)
let dbPosts = [];
try {
	const db = Astro.locals.runtime.env.DB;
	const { results } = await db.prepare("SELECT * FROM manual_posts ORDER BY created_at DESC").all();
	dbPosts = results.map(p => ({
		id: `db_${p.id}`,
		slug: `/manual/${p.id}`,
		title: p.title,
		summary: p.summary,
		image: p.image_url || '/images/default-post.png',
		date: p.created_at.split(' ')[0].replace(/-/g, ''),
		source: 'db'
	}));
} catch (e) {
	console.error("DB ë¡œë“œ ì‹¤íŒ¨:", e);
}

// 3. ë‘ ëª©ë¡ í•©ì¹˜ê¸° ë° ìµœì‹ ìˆœ ì •ë ¬
const allPosts = [...formattedFilePosts, ...dbPosts].sort((a, b) => b.date.localeCompare(a.date));
---

<Layout title="GTB ë§¤ê±°ì§„ - íŠ¸ë Œë“œì˜ ìµœì „ì„ ">
	<div class="hero-section">
		<div class="container">
			<h2>ë§¤ì¼ ë§Œë‚˜ëŠ” ìƒˆë¡œìš´ í†µì°° ğŸ”¥</h2>
			<p>ê¸€ë¡œë²Œ íŠ¸ë Œë“œë¶€í„° IT, ê±´ê°•ê¹Œì§€ ì „ë¬¸ê°€ì˜ ì‹œì„ ìœ¼ë¡œ ë‹´ì•„ëƒ…ë‹ˆë‹¤.</p>
		</div>
	</div>

	<div class="container">
		<div class="grid">
			{allPosts.map((post) => (
				<article class="card">
					<a href={post.slug}>
						<div class="card-image">
							<img src={post.image} alt={post.title} loading="lazy" />
						</div>
						<div class="card-content">
							<span class="tag">Trend</span>
							<h3>{post.title}</h3>
							<p class="summary">{post.summary}</p>
							<div class="card-footer">
								<span class="date">{post.date.replace(/(\d{4})(\d{2})(\d{2})/, '$1. $2. $3')}</span>
								<span class="read-more">ë” ë³´ê¸° â†’</span>
							</div>
						</div>
					</a>
				</article>
			))}
		</div>
	</div>
</Layout>

<style>
	.hero-section { background: white; padding: 4rem 0; text-align: center; margin-bottom: 3rem; border-bottom: 1px solid #f3f4f6; }
	.hero-section h2 { font-size: 2.2rem; font-weight: 800; letter-spacing: -1.5px; margin-bottom: 0.5rem; }
	.hero-section p { color: #64748b; font-size: 1.1rem; }
	.grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; }
	.card { background: white; border-radius: 16px; overflow: hidden; border: 1px solid #f1f5f9; transition: all 0.3s ease; }
	.card:hover { transform: translateY(-8px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
	.card-image { aspect-ratio: 16/9; overflow: hidden; }
	.card-image img { width: 100%; height: 100%; object-fit: cover; }
	.card-content { padding: 1.5rem; }
	.tag { font-size: 0.75rem; color: #2563eb; font-weight: 700; margin-bottom: 0.5rem; display: block; }
	.card h3 { font-size: 1.25rem; font-weight: 700; margin-bottom: 0.75rem; line-height: 1.4; }
	.summary { font-size: 0.95rem; color: #475569; line-height: 1.6; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
	.card-footer { margin-top: 1.5rem; display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; color: #94a3b8; }
	.read-more { color: #2563eb; font-weight: 600; }
</style>
